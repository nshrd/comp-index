# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º —Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é —Å–∞–π—Ç–∞

## üö® –ü—Ä–æ–±–ª–µ–º–∞: –°–∞–π—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

1. **–ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   cd /home/comp-index
   make debug-server
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:**
   ```bash
   ./diagnose.sh
   ```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### 1. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
- `Connection reset by peer`
- Nginx –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ "cannot load certificate"
- HTTPS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ –ê: –í—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ HTTP**
```bash
make http-only
```

**–†–µ—à–µ–Ω–∏–µ –ë: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSL**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π
make check-dns

# –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
make ssl-setup

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
make ssl-status
```

#### 2. –§–∞–π–µ—Ä–≤–æ–ª–ª –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ—Ä—Ç—ã 80/443 –Ω–µ –æ—Ç–≤–µ—á–∞—é—Ç –∏–∑–≤–Ω–µ
- –õ–æ–∫–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏–∑–≤–Ω–µ –Ω–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ ufw
sudo ufw status

# –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–æ–≤
sudo ufw allow 80
sudo ufw allow 443

# –ü—Ä–æ–≤–µ—Ä–∫–∞ iptables
sudo iptables -L INPUT -n | grep -E "(80|443)"
```

#### 3. Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- Nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –û—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –ª–æ–≥–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker exec $(docker compose ps -q nginx) nginx -t

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs $(docker compose ps -q nginx)

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –±–∞–∑–æ–≤—É—é HTTP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
make http-only
```

#### 4. Docker —Å–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã, –Ω–æ –Ω–µ –æ—Ç–≤–µ—á–∞—é—Ç
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–µ—Ç–µ–π
docker compose down
docker network prune -f
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–π
docker network ls
docker network inspect comp-index_default
```

### –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

#### –®–∞–≥ 1: –ë–∞–∑–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
cd /home/comp-index
make debug-server
```

#### –®–∞–≥ 2: –ï—Å–ª–∏ HTTPS –ø—Ä–æ–±–ª–µ–º—ã - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ HTTP
```bash
make http-only
```

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
```bash
curl -I http://charts.expert
curl -I http://localhost
```

#### –®–∞–≥ 4: –ï—Å–ª–∏ HTTP —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ –∏–∑–≤–Ω–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–µ—Ä–≤–æ–ª–ª–∞
sudo ufw status
sudo ufw allow 80
sudo ufw allow 443

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ IP
curl -s ifconfig.me
```

#### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL (–ø–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º)
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
make check-dns

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
make ssl-setup

# –í–æ–∑–≤—Ä–∞—Ç –∫ HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker compose down
cp nginx/nginx.conf.backup nginx/nginx.conf
cp docker-compose.yml.backup docker-compose.yml
docker compose up -d
```

### –ö–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
make debug-server

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π
make check-dns

# –°—Ç–∞—Ç—É—Å SSL
make ssl-status

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ HTTP
make http-only

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
docker compose logs -f nginx
```

### –õ–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

1. **Nginx –ª–æ–≥–∏:**
   ```bash
   docker logs $(docker compose ps -q nginx)
   ```

2. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏:**
   ```bash
   sudo journalctl -u docker -f
   ```

3. **–õ–æ–≥–∏ —Ñ–∞–π–µ—Ä–≤–æ–ª–ª–∞:**
   ```bash
   sudo tail -f /var/log/ufw.log
   ```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `make debug-server` –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—ã–≤–æ–¥
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs --tail=50`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å DNS: `make check-dns`

### –í–æ–∑–≤—Ä–∞—Ç –∫ HTTPS –ø–æ—Å–ª–µ –æ—Ç–ª–∞–¥–∫–∏

–ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å HTTP:

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω:**
   ```bash
   make check-dns
   ```

2. **–ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:**
   ```bash
   make ssl-setup
   ```

3. **–í–µ—Ä–Ω–∏—Ç–µ HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   docker compose down
   cp nginx/nginx.conf.backup nginx/nginx.conf
   cp docker-compose.yml.backup docker-compose.yml
   docker compose up -d
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
   ```bash
   curl -I https://charts.expert
   make ssl-status
   ``` 